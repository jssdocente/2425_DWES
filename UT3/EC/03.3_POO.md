# 03.3 Ejercicios avanzados POO con PHP

Estos ejercicios est치n pensados para que puedas practicar y afianzar los conocimientos adquiridos en el tema de POO.

### 游꿢 Objetivos

- Trabajar y ver todas las posibilidades de los Enumerados en PHP.
- Aplicar Herencia y Composici칩n de manera conjunta.
- Aplicar t칠cnicas avanzadas con Objetos en PHP.

### 九勇 Entrega

Normas de entrega:

- Se guardar치n dentro de la estructura de carpetas del tema `UT3`, carpeta ejercicios `EC`y `03`. En la ruta `UT3\EC\03\`.
- Cada ejericio se entregar치 en un archivo independiente, con el nombre que se indique en cada ejercicios.
- No es necesario entregarlos como tarea, pero si es necesario realizarlos, y se preguntar치n aleatoriamente en clase.


### 游녤 Recursos

Para facilitar la realizaci칩n del ejercicio se adjunta al final un Anexo con el [diagrama de clases](#diagramas-de-clases) de la jerarqu칤a de clases de animales. Este diagrama es completo, una vez realizado todos los ejercicios de esta hoja.

## Ejercicios Bloque 3.

### Ejercicio 301

nombre-fichero: `03.301_Ejercicio.php`

> **Crea un enum con nombre `CartasJuegoTipoEm` que contenga los siguientes juegos de cartas espa침oles:**
    
   - SOLITARIO = 1
   - _7YMEDIA = 2
   - BRISCA = 3
   - ESCOBA = 4
   - MUS = 5
   - CHINCHON = 6


Vamos a realizar una baraja de cartas espa침olas con POO.

> **A. Crea una clase Enumerado CartaTipo de tipo `int` con las siguientes constantes:**

  - REY = 12
  - CABALLO = 11
  - SOTA = 10
  - SIETE = 7
  - SEIS = 6
  - CINCO = 5
  - CUATRO = 4
  - TRES = 3
  - DOS = 2
  - AS = 1

> **B. Crea una clase `enum` CartaPalo de tipo `int` con las siguientes constantes:**

  - OROS = 1
  - COPAS = 2
  - ESPADAS = 3
  - BASTOS = 4


> **C. Crea una clase `Carta` que tenga dos propiedades privadas, tipo (CartaTipo), palo (CartaPalo) e imagen (string).**

  - Esta clase tendr치 un constructor privado que reciba como par치metros el tipo y el palo de la carta.
  - Para poder construir cartas se utilizar치 un patr칩n FactoryMethod, creando un m칠todo `crearCarta` est치tico que reciba como par치metros el tipo y el palo de la carta, y devuelva una instancia de la clase. (para su implementaci칩n utiliza un m칠todo est치tico).
  - Ser치 inmutable, es decir, una vez creada, no se podr치 modificar sus propiedades (atributos p칰blicos solo lectura).
  - agregar un m칠todo `__toString()` que devuelva el nombre de la carta (por ejemplo: "Rey de Oros").
  - agregar un m칠todo `getValue()` que devuelva el valor de la carta (por ejemplo: 12).

> **D. Crea una interface `ISortable` con los m칠todos `sortAsc` y `sortDesc`.**

> **E. Crea una clase `Baraja` que contenga las 40 cartas de la baraja espa침ola, en un array de cartas.**

  En el constructor crea las 40 cartas, utilizado forech para recorrer los palos y los tipos de cartas. (Enum::cases()).

  Tendr치 los siguientes m칠todos:
  - `barajar`: ordenar치 aleatoriamente las cartas de la baraja (sin devolver nada).
  - `darCarta`: devolver치 la siguiente carta de la baraja, y la eliminar치 de la baraja. (La primera carta). Utiliza el m칠todo `array_shift` para eliminar la primera carta.
  - `darCartas`: devolver치 un n칰mero de cartas pasado como par치metro, y las eliminar치 de la baraja. Utiliza el m칠todo `darCarta` para obtener las cartas.
  - `cartasDisponibles`: devolver치 el n칰mero de cartas que quedan en la baraja.

  Implementar치 la interface `ISortable` con los m칠todos `sortAsc` y `sortDesc` que ordenar치n las cartas de la baraja de forma ascendente y descendente respectivamente. Utiliza el m칠todo `usort` para ordenar las cartas, y el operador `spaceship` para comparar las cartas. (operador de comparaci칩n de PHP).


> **F. Crea una clase `JugadorInfo` en base a los siguiente requerimientos:**
      
  - Tendr치 un nombre, un Ranking (puntos) y un habilidad (lista de los juegos que sabe jugar).
  - En el constructor se le pasar치 solamente el nombre, y el resto de propiedades se inicializar치n a 0 o vac칤as.

  M칠todos:
  - addRanking: que sumar치 puntos al ranking.
  - addHabilidad: que a침adir치 un juego a la lista de habilidades.
  - isPlayto: que devolver치 si el jugador sabe jugar a un juego pasado como par치metro.
  - __toString: que devolver치 el nombre del jugador.

> **G. Crea una clase `PlayerCartas` que contenga informaci칩n del Jugador a trav칠s de la clase `JugadorInfo`. Esta clase se utiliza para cuando un jugador juega a un juego de cartas**

  - Tendr치 un JugadorInfo.
  - Tendr치 el tipo del juego (CartasJuegoTipo).
  - Propiedad `getName` que devolver치 el nombre del jugador. El nombre del jugador lo obtendr치 del JugadorInfo (propiedad `jugador`)
  - Tenga un estado de si est치 jugando o no, para cambiar el estado `setStatus(bool $playing)` y `isPlaying`.

  M칠todos:
  - `addCartas`: que aceptar치 un n칰meros indefinido de cartas y las a침adir치 al jugador. (operador variadics)
  - `getCartas`: que devolver치 las cartas del jugador.
  - `getTotalPuntos`: que devolver치 la suma de los puntos de las cartas del jugador.
  - `__toString`: que devolver치 el nombre del jugador, su ranking y sus habilidades, y las cartas que tiene.
  
> **H. Crea una clase `JuegoCartas` (no instanciable) que sea la clase base, y que tenga los :**

  Atributos/Propiedades:
  - juego (tipo de juego). No p칰blico y solo lectura.
  - baraja (privada). No p칰blica
  - ganador (privado). No p칰blico y permite null.

  M칠todos
  - `addJugadores(PlayerCartas ...$jugadores)`: que a침adir치 jugadores al juego. Comprobar치 que todos los jugadores sean del mismo tipo de juego. Si no lo son, lanzar치 una excepci칩n.
  - `reparteCarta`: que ser치 abstracto (debe ser implementado en las clases hijas).
  - `getLasCartaRepartida`: que devolver치 la 칰ltima carta repartida.
  - `getTurno`: que devolver치 el jugador que tiene el turno.
  - `getGanador`: que devolver치 el jugador que ha ganado la partida.
  - `getJugadores`: que devolver치 un array con los jugadores.
  - `isPlaying`: que devolver치 si el juego est치 en curso o no.
  - `start`: abstracto. Iniciar치 el juego.
  - `end`: abstracto. Obtiene el ganador y cambia a finalizado el juego.
  - `getRankingScore`: que devolver치 un array con los jugadores ordenados por puntos decrecientes.
  
  Crea los atributos necesarios para implementar los m칠todos anteriores.

> **I. Crea una clase  `Juego7yMedio` que herede de `JuegoCartas` y que aplique la siguiente l칩gica de juego:**

  Funciones privadas:
  - `nextPlayer`: que pasar치 el turno al siguiente jugador. Si el jugador actual es el 칰ltimo, retornar치 null.
  - `calcularGanador`: que calcular치 el ganador de la partida, y asignar치 el valor al atributo `$ganador`.
  - `cambiarTurno`: que cambiar치 el turno al siguiente jugador, y asignar치 el valor al atributo `$jugadorActual`.
  - `getTurno`: que devolver치 el jugador que tiene el turno.
  - `reparteCarta`: reparte carta al jugador que tiene el turno, si se pasa de 7.5 puntos pasar치 el turno al siguiente jugador. Si el turno-actual es null, se llamar치 al m칠todo `end`.
  - `start`: indica juego est치 en curso, inicializa la baraja, baraja las cartas, y asigna el turno al primer jugador
  - `end`: indica que el juego est치 finalizado, y calcula el ganador.

  M칩do de funcionamiento:
  - Comiezan el juego en m칠todo `start` (inicializa la baraja, baraja las cartas, y asigna el turno al primer jugador).
  -  Reparte carta al jugador que tenga el turno.
  -  Si el jugador se pasa de 7 y medio, pasa el turno al siguiente jugador.
  - El juego seguir치 hasta que todos los jugadores hayan jugado.<br>
  - Ganar치 el Jugador que m치s se acerque a 7 y medio (todos se han pasado, gana el que menos se haya pasado).<br>
  - El juego estar치 procesando hasta que se finalice el juego. Una vez finalizado debe haber un ganador.



### Ejercicio 302

> nombre-fichero: `03.302_SieteYMedia.php`

En base a toda la estructura del ejercicio 301, crea una peque침o programa que simule el juego de las 7 y media.<br>
Crea en la simulaci칩n al menos 3 jugadores.<br>

Cada vez que se llame a la p치gina, iniciar치 una nueva partida, y obtendr치 el n칰mero de jugadores de un par치metro GET["players"], en caso de no existir, se tomar치 3 jugadores por defecto.<br>
Los jugadores se crear치n con un nombre aleatorio.

El juego mostrar치 en pantalla la evoluci칩n de la partida, y al finalizar mostrar치 el ganador.

Ej:

Comienza la partida.
- Jugador 1 (nombre): Reparte carta `Rey de Oros` (total: 3).
- Jugador 1 (nombre): Reparte carta `Caballo de Copas` (total: 6).
- Jugador 1 (nombre): Reparte carta `Sota de Espadas` (total: 9.5).  

Siguiente jugador... (nombre)
- Jugador 2 (nombre): Reparte carta ...
- Jugador 2 (nombre): Reparte carta ...

Siguiente jugador... (nombre)
- Jugador 3 (nombre): Reparte carta ...
- Jugador 3 (nombre): Reparte carta ...
- Jugador 3 (nombre): Reparte carta ...

Ha ganado el Jugador 1 (nombre) con un total de 7.5 puntos.

Ranking de la partida

1. Jugador 3 (nombre) - 5.5 puntos
2. Jugador 2 (nombre) - 6.5 puntos
3. Jugador 1 (nombre) - 7.5 puntos
...


Para que os sirva de gu칤a, os dejo la p치gina web que implementa el juego.

```php	
<?php
$player1 = new PlayerCartas(new JugadorInfo("Javier"), CartasJuegoTipo::_7YMEDIA);
$player2 = new PlayerCartas(new JugadorInfo("Manolo"), CartasJuegoTipo::_7YMEDIA);
$player3 = new PlayerCartas(new JugadorInfo("Pedro"), CartasJuegoTipo::_7YMEDIA);

$juego = new Juego7yMedia();
$juego->addJugadores($player1, $player2, $player3);

$juego->start();


?>

<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Siete y media</title>
</head>
<body>
<h2>Comienza la partida. Juego de las SieteYMedia</h2>
<h4>Empieza jugador: <?= $juego->getTurno()?->jugador->nombre ?? "turno desconocido"; ?></h4>

<?php
do {

    $jugadorTurno = $juego->getTurno();
    do {
        $juego->reparteCarta();
        $carta = $juego->getLasCartaRepartida();
        if ($carta) {
            echo "<p>Jugador {$juego->getTurno()}: carta repartida: {$carta} ({$carta->getValue()}) puntos </p>";
        }

    } while ($juego->getTurno() === $jugadorTurno);

    if ($juego->isPlaying()) {
        echo "<h4>Siguiente turno: {$juego->getTurno()} ... </h4>";
    }

} while ($juego->isPlaying())
?>

<h3>Ha ganado el jugador: <?= $juego->getGanador() ?></h3>
<br>
<h2>Ranking de la partida</h2>
<ul>
    <?php foreach ($juego->getRankingScore() as $player) : ?>
        <li><?= $player->jugador->nombre ?>: <?= $player->getTotalPuntos() ?> puntos</li>
    <?php endforeach; ?>
</ul>
</body>
</html>
```	


### Anexo 

#### Diagramas de clases

![Jerarquia de clases de animales](./.res/img/03.3.class_diagram.png)